{% extends "base.html" %}

{% block title %}{{ page.title }} | {{ super() }}{% endblock title %}

{% block meta_description %}{% if page.description %}{{ page.description }}{% else %}Lev Vereshchagin's personal website{% endif %}{% endblock meta_description %}

{% block content %}
<link rel="stylesheet" type="text/css" href="/syntax-theme-light.css" media="(prefers-color-scheme: light)" />
<link rel="stylesheet" type="text/css" href="/syntax-theme-dark.css" media="(prefers-color-scheme: dark)" />
<style>
    .page-title {
        font-size: 2rem;
        margin-top: 0;
        margin-bottom: 0;
        text-wrap: balance;
    }

    .post-meta {
        color: var(--color-text-secondary);
        margin-top: var(--size-xs);
        margin-bottom: var(--size-md);
        display: flex;
        flex-wrap: wrap;
    }

    .post-meta > * {
        white-space: nowrap;
    }

    .post-footer {
        margin-top: var(--size-lg);
        display: flex;
        flex-wrap: wrap;
        column-gap: var(--size-lg);
        row-gap: var(--size-sm);
        text-wrap: balance;
    }

    .post-footer > *:first-child {
        flex: 1;
        white-space: nowrap;
    }

    .page-content {
        margin-top: var(--size-md);
    }
</style>
{% block page_structured_data %}
{% if not page.extra.info_page %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ page.permalink | safe }}"
    },
    "headline": "{{ page.title | escape }}",
    {% if page.description %}
    "description": "{{ page.description | escape }}",
    {% endif %}
    "datePublished": "{{ page.date | date(format='%Y-%m-%d') }}",
    {% if page.updated %}
    "dateModified": "{{ page.updated | date(format='%Y-%m-%d') }}",
    {% else %}
    "dateModified": "{{ page.date | date(format='%Y-%m-%d') }}",
    {% endif %}
    "author": {
        "@type": "Person",
        "name": "Lev Vereshchagin"
    },
    "publisher": {
        "@type": "Person",
        "name": "Lev Vereshchagin"
    },
    {% if page.taxonomies.tags %}
    "keywords": [{% for tag in page.taxonomies.tags %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}],
    {% endif %}
    "articleBody": "{{ page.content | striptags | escape | truncate(length=200) }}"
}
</script>
{% endif %}
{% endblock page_structured_data %}

<article>
    <h1 class="page-title">{{ page.title }}</h1>
    {% if not page.extra.info_page %}
    <div class="post-meta">
        {% if page.date %}
        {% if lang == "ru" %}
        {% set english_days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] %}
        {% set russian_days = ["понедельник", "вторник", "среда", "четверг", "пятница", "суббота", "воскресенье"] %}
        {% set english_day = page.date | date(format="%A") %}
        {% for i in range(end=7) %}
        {% if english_days[i] == english_day %}
        {% set_global russian_day = russian_days[i] %}
        {% endif %}
        {% endfor %}
        {{ page.date | date(format="%Y-%m-%d") }}, {{ russian_day }}
        {% else %}
        {{ page.date | date(format="%Y-%m-%d, %A") }}
        {% endif %}
        {% endif %}
        {% set_global is_original = false %}
        {% set_global translation_type = "" %}
        {% set_global tag_count = 0 %}
        {% for key, value in page.taxonomies %}
        {% if key == "tags" %}
        {% if "original-lang" in value %}
        {% set_global is_original = true %}
        {% set_global tag_count = tag_count + 1 %}
        {% endif %}
        {% if "human-translation" in value %}
        {% set_global translation_type = "human" %}
        {% set_global tag_count = tag_count + 1 %}
        {% endif %}
        {% if "ai-translation" in value %}
        {% set_global translation_type = "ai" %}
        {% set_global tag_count = tag_count + 1 %}
        {% endif %}
        {% endif %}
        {% endfor %}
        {% if tag_count > 1 %}
        {{ throw(message="Multiple translation tags found in " ~ page.relative_path ~ "! Posts must have exactly one of:
        original-lang, human-translation, ai-translation") }}
        {% endif %}
        {% if not is_original %}
        &nbsp;&middot;&nbsp;&nbsp;
        {% if translation_type == "ai" %}
        {% if page.lang == "en" %}
        Translated from Russian with AI
        {% elif page.lang == "ru" %}
        Переведено с английского с помощью ИИ
        {% endif %}
        {% else %}
        {% if page.lang == "en" %}
        Translated from Russian
        {% elif page.lang == "ru" %}
        Перевод с английского
        {% endif %}
        {% endif %}
        {% endif %}
        {% if page.translations %}
        {% for translation in page.translations %}
        {% if is_original %}
        {% if page.lang == "en" and translation.lang == "ru" %}
        &nbsp;&middot;&nbsp;&nbsp;<a href="{{ translation.permalink }}">Читать перевод</a>
        {% elif page.lang == "ru" and translation.lang == "en" %}
        &nbsp;&middot;&nbsp;&nbsp;<a href="{{ translation.permalink }}">Read translation</a>
        {% endif %}
        {% else %}
        {% if page.lang == "en" and translation.lang == "ru" %}
        &nbsp;&middot;&nbsp;&nbsp;<a href="{{ translation.permalink }}">Читать оригинал</a>
        {% elif page.lang == "ru" and translation.lang == "en" %}
        &nbsp;&middot;&nbsp;&nbsp;<a href="{{ translation.permalink }}">Read English original</a>
        {% endif %}
        {% endif %}
        {% endfor %}
        {% endif %}
    </div>
    {% endif %}
    <div class="page-content">
        {{ page.content | safe }}
    </div>

    {% if not page.extra.info_page %}
    <nav aria-label="Post navigation" class="post-footer">
        <a href="{% if lang == "ru" %}/ru/{% else %}/{% endif %}" class="post-nav-link">← {% if lang == "ru"
            %}Главная{% else %}Home{% endif %}</a>
        {% if page.higher %}
        <div>
            <a href="{{ page.higher.permalink }}" class="post-nav-link">
                {{ page.higher.title }} →
            </a>
        </div>
        {% endif %}
    </nav>
    {% endif %}
</article>
{% endblock content %}
